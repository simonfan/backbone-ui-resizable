//     BackboneUiDraggable
//     (c) simonfan
//     BackboneUiDraggable is licensed under the MIT terms.

//     backbone-ui-resizable
//     (c) simonfan
//     backbone-ui-resizable is licensed under the MIT terms.

define("__backbone-ui-draggable/move",["require","exports","module"],function(t,e){function i(t,e,i){return isNaN(e)||(t=t>e?t:e),isNaN(i)||(t=i>t?t:i),t}function s(t){return parseInt(t,10)}e.moveX=function(t,e){if(t){if(-1===this.axis.indexOf("x"))return t;var n=this.model,o=parseInt(n.get("left"),10),h=o+t,a=s(n.get("minX")),l=s(n.get("maxX"))-s(this.$el.width()),r=i(h,a,l);n.set("left",s(r)),n.set(this.valueAttribute,this.toValue(n));var c=n.get("left")-o;return e||this.trigger("move",this,{axis:"x",delta:c}).trigger("move-x",this,c),t-c}return 0},e.moveY=function(t,e){if(t){if(-1===this.axis.indexOf("y"))return t;var n=this.model,o=parseInt(n.get("top"),10),h=o+t,a=s(n.get("minY")),l=s(n.get("maxY"))-s(this.$el.height()),r=i(h,a,l);n.set("top",s(r)),n.set(this.valueAttribute,this.toValue(n));var c=n.get("top")-o;return e||this.trigger("move",this,{axis:"y",delta:c}).trigger("move-y",this,c),t-c}return 0},e.moveToLeft=function(t,e){return this.moveX(-1*t,e)},e.moveToRight=function(t,e){return this.moveX(t,e)},e.moveToTop=function(t,e){return this.moveY(-1*t,e)},e.moveToBottom=function(t,e){return this.moveY(t,e)}}),define("backbone-ui-draggable",["require","exports","module","lowercase-backbone","model-dock","lodash","jquery","./__backbone-ui-draggable/move"],function(t,e,i){function s(t){return r.test(t)?t+"px":t}function n(t){return parseInt(t)}var o=t("lowercase-backbone"),h=t("model-dock"),a=t("lodash"),l=t("jquery"),r=/^[0-9\-]+$/,c=i.exports=h.extend({initialize:function(t){o.view.prototype.initialize.call(this,t),this.initializeModelDock(t),this.initializeUIDraggable(t)},initializeUIDraggable:function(t){a.bindAll(this,"mousedown","mousemove","mouseup"),this.$window=l(window),this.$canvas=t.canvas||this.canvas||this.$el.parent();var e=this.$el.position(),i=l.extend({status:"stopped",top:n(e.top),left:n(e.left)},t),s=this.model;s.set(i);var o=this.valueAttribute;if(this.listenTo(s,"change:"+o,function(t){var e=this.toPosition(t.get(o));t.set({top:n(e.top),left:n(e.left)})},this),s.get(o)){var e=this.toPosition(s.get(o));s.set({top:n(e.top),left:n(e.left)})}else s.set(o,this.toValue(s))},events:{mousedown:"mousedown"},mousedown:function(t){if(this.$el.is(t.target)&&1===t.which){this.model.set("status","dragging"),this.lastPosition={x:t.pageX,y:t.pageY};var e=this.$el.offset();return this.handlePosition={x:t.pageX-e.left,y:t.pageY-e.top},this.$window.on("mousemove",this.mousemove).on("mouseup",this.mouseup),this.trigger("movestart",this),!1}},mousemove:function(t){var e=this.lastPosition,i=t.pageX,s=t.pageY,n=i-e.x,o=s-e.y,h=this.$el.offset(),a=this.handlePosition.x+h.left,l=this.handlePosition.y+h.top;return(n>0&&i>a||0>n&&a>i)&&this.moveX(n),(o>0&&s>l||0>o&&l>s)&&this.moveY(o),e.x=i,e.y=s,!1},mouseup:function(){this.$window.off("mousemove",this.mousemove),delete this.lastPosition,this.model.set("status","stopped"),this.trigger("movestop",this)},axis:"xy",valueAttribute:"value",setValue:function(t){return this.model.set(this.valueAttribute,t),this},toValue:function(t){return"At "+t.get("top")+" x "+t.get("left")},toPosition:function(t){var e=t.split("x");return{top:e[0].replace(/[^0-9\-]/g,""),left:e[1].replace(/[^0-9\-]/g,"")}},map:{left:"->css:left",top:"->css:top"},stringifiers:{left:s,top:s}});c.proto(t("./__backbone-ui-draggable/move"))}),define("__backbone-ui-resizable/build-handles",["require","exports","module","jquery","lodash"],function(t,e,i){function s(t,e){var i=e.clss,s=h("<div></div>");return s.addClass(i).addClass(i+"-"+t),s.insertAfter(this.$el)}function n(t,e){if(a.isArray(t)){var i=a.map(t,function(t){return s.call(this,t,e)},this);return a.zipObject(t,i)}return a.isObject(t)?a.mapValues(t,function(t,i){return t=a.isObject(t)?t:this.$el.find(t),0!==t.length?t:s.call(this,i,e)},this):a.isString(t)?(t=t.replace(" ",""),t=t.split(","),n.call(this,t,e)):void 0}function o(t,e){return a.mapValues(t,function(t,i){return this.handleBuilder(a.extend({},e,{el:t,direction:i,resizable:this,thickness:a.isNumber(e.thickness)?e.thickness:e.thickness[i],hook:a.isNumber(e.hook)?e.hook:e.hook[i],canvas:resizable.$canvas}))},this)}var h=t("jquery"),a=t("lodash");i.exports=function(t){var e=(t.directions,n.call(this,t.directions,t));this.handles=o.call(this,e,t)}}),define("__backbone-ui-resizable/handle/update",["require","exports","module"],function(t,e){function i(t){this.model.set("top",parseInt(this.resizable.model.get("top"),10)+parseInt(t,10))}function s(t){this.model.set("top",parseInt(this.resizable.model.get("top"),10)+this.resizable.model.get("height")+parseInt(t,10))}function n(t){this.model.set("left",parseInt(this.resizable.model.get("left"),10)+parseInt(t,10))}function o(t){this.model.set("left",parseInt(this.resizable.model.get("left"),10)+this.resizable.model.get("width")+parseInt(t,10))}function h(){this.model.set("width",this.resizable.model.get("width"))}function a(){this.model.set("height",this.resizable.model.get("height"))}e.n=function(){console.log("resizable"),console.log(this.resizable.model.attributes),console.log("model"),console.log(this.model.attributes),i.call(this,-this.hook),n.call(this,0),h.call(this)},e.s=function(){s.call(this,-this.thickness+this.hook),n.call(this,0),h.call(this)},e.w=function(){n.call(this,-this.hook),i.call(this,0),a.call(this)},e.e=function(){o.call(this,-this.thickness+this.hook),i.call(this,0),a.call(this)},e.nw=function(){i.call(this,-this.hook),n.call(this,-this.hook)},e.ne=function(){i.call(this,-this.hook),o.call(this,-this.thickness+this.hook)},e.sw=function(){s.call(this,-this.thickness+this.hook),n.call(this,-this.hook)},e.se=function(){s.call(this,-this.thickness+this.hook),o.call(this,-this.thickness+this.hook)}}),define("__backbone-ui-resizable/handle/track",["require","exports","module"],function(t,e){e.all=function(){this.listenTo(this.resizable.model,"change",this.update)},e.n=function(){var t=this.resizable.model;this.resizable.listenTo(this,"move-y",function(e,i){var s=t.get("height"),n=t.get("top");t.set({height:s-i,top:n+i})},this)},e.s=function(){var t=this.resizable.model;this.resizable.listenTo(this,"move-y",function(e,i){t.set("height",t.get("height")+i)})},e.w=function(){var t=this.resizable.model;this.resizable.listenTo(this,"move-x",function(e,i){var s=t.get("width"),n=t.get("left");t.set({width:s-i,left:n+i})})},e.e=function(){var t=this.resizable.model;this.resizable.listenTo(this,"move-x",function(e,i){t.set("width",t.get("width")+i)})}}),define("__backbone-ui-resizable/handle/helpers",["require","exports","module"],function(t,e){e.min=function(t,e){return isNaN(t)?e:isNaN(e)?t:e>t?t:e},e.max=function(t,e){return isNaN(t)?e:isNaN(e)?t:t>e?t:e}}),define("__backbone-ui-resizable/handle/min-max",["require","exports","module","./helpers"],function(t,e){var i=t("./helpers");e.n=function(){var t=this.resizable.model,e=t.get("height"),s=t.get("minHeight"),n=t.get("maxHeight"),o=n-e,h=e-s,a=t.get("minY")||0,l=this.model.get("top");this.model.set({minY:i.max(l-o,a),maxY:l+h})},e.s=function(){var t=this.resizable.model,e=t.get("height"),s=t.get("minHeight"),n=t.get("maxHeight"),o=e-s,h=n-e,a=t.get("maxY")||0,l=this.model.get("top");this.model.set({minY:l-o,maxY:i.min(l+h,a)})},e.w=function(){var t=this.resizable.model,e=t.get("width"),s=t.get("minWidth"),n=t.get("maxWidth"),o=n-e,h=e-s,a=t.get("minX")||0,l=this.model.get("left");this.model.set({minX:i.max(l-o,a),maxX:l+h})},e.e=function(){var t=this.resizable.model,e=t.get("width"),s=t.get("minWidth"),n=t.get("maxWidth"),o=e-s,h=n-e,a=t.get("maxX"),l=this.model.get("left");this.model.set({minX:l-o,maxX:i.min(l+h,a)})}}),define("__backbone-ui-resizable/handle/index",["require","exports","module","backbone-ui-draggable","./update","./track","./min-max"],function(t,e,i){{var s=t("backbone-ui-draggable"),n=t("./update"),o=t("./track"),h=t("./min-max"),a={n:"left top",s:"left bottom",w:"left top",e:"right top",nw:"left top",ne:"right top",sw:"left bottom",se:"right bottom"},l={n:"y",s:"y",w:"x",e:"x",nw:"xy",ne:"xy",sw:"xy",se:"xy"};i.exports=s.extend({initialize:function(t){s.prototype.initialize.call(this,t),this.initializeResizableHandle(t)},initializeResizableHandle:function(t){this.resizable=t.resizable,this.direction=t.direction,this.axis=l[this.direction],this.thickness=t.thickness,this.setStyles(),this.hook=this.thickness*t.hook,this.update=_.throttle(_.bind(n[this.direction],this),20),this.initializePosition(t),this.track(),this.on("movestart",this.calcMinMax)},setStyles:function(){var t=this.axis;if(t.length>1)var e={zIndex:100,width:this.thickness,height:this.thickness};else if("x"===t)var e={zIndex:99,width:this.thickness,height:this.resizable.model.get("width")};else if("y"===t)var e={zIndex:99,width:this.resizable.model.get("height"),height:this.thickness};this.$el.css(e)},calcCenter:function(t){this.center={x:this.$el.width()*t,y:this.$el.height()*t}},initializePosition:function(){var t=this.$el;t.position({my:"center center",at:a[this.direction],of:this.resizable.$el}),this.model.set(t.position()),this.update()},track:function(){_.each(this.direction,function(t){o[t].call(this)},this),o.all.call(this)},calcMinMax:function(){_.each(this.direction,function(t){h[t].call(this)},this)},map:_.extend(s.prototype.map,{height:"->css:height",width:"->css:width"})})}}),define("backbone-ui-resizable",["require","exports","module","jquery-ui-resizable","lowercase-backbone","backbone-ui-draggable","lodash","./__backbone-ui-resizable/build-handles","./__backbone-ui-resizable/handle/index"],function(t,e,i){function s(t){return r.test(t)?t+"px":t}t("jquery-ui-resizable");{var n=t("lowercase-backbone"),o=t("backbone-ui-draggable"),h=t("lodash"),a=t("./__backbone-ui-resizable/build-handles"),l=t("./__backbone-ui-resizable/handle/index"),r=/^[0-9]+$/;i.exports=o.extend({initialize:function(t){n.view.prototype.initialize.call(this,t),this.initializeModelDock(t),this.initializeUIDraggable(t),this.initializeUIResizable(t)},initializeUIResizable:function(t){this.$canvas=t.canvas||this.canvas||$(window);var e=h.extend({minWidth:2*this.handleOptions.thickness,minHeight:2*this.handleOptions.thickness,width:this.$el.width(),height:this.$el.height()},this.$el.position(),t);this.model.set(e);var i=h.defaults(h.pick(t,["directions","clss","hook","thickness"]),this.handleOptions);a.call(this,i)},handleBuilder:l,handleOptions:{directions:"n,s,w,e,nw,ne,sw,se",clss:"handle",hook:.2,thickness:30},stringifiers:{height:s,minHeight:s,maxHeight:s,width:s,minWidth:s,maxWidth:s,left:s,top:s},map:{top:"->css:top",left:"->css:left",width:"->css:width",minWidth:"->css:min-width",maxWidth:"->css:max-width",height:"->css:height",minHeight:"->css:min-height",maxHeight:"->css:max-height"}})}});